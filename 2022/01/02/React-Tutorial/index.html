<!DOCTYPE html><html lang="en-us"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>React Tutorial 解析 | Kyno's Blog🐱‍🏍</title><meta name="description"><meta name="generator" content="Kyno's Blog🐱‍🏍"><meta name="author" content="Kyno Yang"><meta name="keywords" content="NUAAer, WHUTer, FanFouer, Music(Guitar, Keyboard, et al.), Reading, Basketball"><meta name="HandheldFriendly" content="True"><meta name="MobileOptimized" content="320"><meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1,user-scalable=0"><link rel="stylesheet" type="text/css" href="/styles/screen.css"><link rel="apple-touch-icon" sizes="57x57" href="/images/apple-touch-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/images/apple-touch-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/images/apple-touch-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/images/apple-touch-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/images/apple-touch-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/images/apple-touch-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/images/apple-touch-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/images/apple-touch-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-180x180.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/images/favicon-96x96.png"><link rel="icon" type="image/png" sizes="160x160" href="/images/favicon-160x160.png"><link rel="icon" type="image/png" sizes="192x192" href="/images/favicon-192x192.png"><meta name="msapplication-TileColor" content="#121315"><meta name="msapplication-TileImage" content="/images/mstile-144x144.png"></head><body itemscope itemtype="https://schema.org/WebPage"><header itemscope itemtype="https://schema.org/WPHeader"><a href="/"><img src="/images/svdb.png" alt="Kyno's Blog🐱‍🏍" title="Kyno's Blog🐱‍🏍"></a><h1><a href="/" alt="Kyno's Blog🐱‍🏍" title="Kyno's Blog🐱‍🏍" itemprop="headline">Kyno's Blog🐱‍🏍</a></h1><p itemprop="description">个人博客</p><nav itemscope itemtype="https://schema.org/SiteNavigationElement"><ul><li itemprop="name"><a href="/" alt="Home" title="Home" itemprop="url">Home</a></li></ul></nav><div class="space"></div></header><main itemscope itemtype="https://schema.org/Blog"><article class="full"><h1 itemprop="headline">React Tutorial 解析</h1><span class="post-meta">Published on<time itemprop="datePublished" datetime="2022-01-02T13:24:39.000Z"> 星期日, 一月 2日 2022 at 21:24</time><br>Last updated on<time itemprop="dateModified" datetime="2022-01-02T13:24:39.000Z"> 星期日, 一月 2日 2022 at 21:36</time></span><h1 id="Tutorial"><a href="#Tutorial" class="headerlink" title="Tutorial"></a>Tutorial</h1><p>React 是一个 JS 库，使用 component 构成 UI 。根据官方提供的教程可以完成一个小游戏，同时梳理教程的安排可以更好地理解如何使用 React 。</p>
<h1 id="整体结构"><a href="#整体结构" class="headerlink" title="整体结构"></a>整体结构</h1><h2 id="Square"><a href="#Square" class="headerlink" title="Square"></a>Square</h2><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Square</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;button className=<span class="string">&quot;square&quot;</span>&gt;</span><br><span class="line">        &#123;<span class="comment">/* TODO */</span>&#125;</span><br><span class="line">      &lt;/button&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Board"><a href="#Board" class="headerlink" title="Board"></a>Board</h2><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Board</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">renderSquare</span>(<span class="params">i</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Square</span> /&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> status = <span class="string">&#x27;Next player: X&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;div className=<span class="string">&quot;status&quot;</span>&gt;&#123;status&#125;&lt;/div&gt;</span><br><span class="line">        &lt;div className=<span class="string">&quot;board-row&quot;</span>&gt;</span><br><span class="line">          &#123;<span class="built_in">this</span>.renderSquare(<span class="number">0</span>)&#125;</span><br><span class="line">	        <span class="comment">/*......*/</span></span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">				<span class="comment">/*......*/</span></span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Game"><a href="#Game" class="headerlink" title="Game"></a>Game</h2><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Game</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div className=<span class="string">&quot;game&quot;</span>&gt;</span><br><span class="line">        &lt;div className=<span class="string">&quot;game-board&quot;</span>&gt;</span><br><span class="line">          &lt;Board /&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div className=<span class="string">&quot;game-info&quot;</span>&gt;</span><br><span class="line">          &lt;div&gt;&#123;<span class="comment">/* status */</span>&#125;&lt;/div&gt;</span><br><span class="line">          &lt;ol&gt;&#123;<span class="comment">/* TODO */</span>&#125;&lt;/ol&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="React-DOM"><a href="#React-DOM" class="headerlink" title="React DOM"></a>React DOM</h2><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ReactDOM.render(</span><br><span class="line">  &lt;Game /&gt;,</span><br><span class="line">  <span class="built_in">document</span>.getElementById(<span class="string">&#x27;root&#x27;</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h1 id="在底层的-Square-中先做些基础工作"><a href="#在底层的-Square-中先做些基础工作" class="headerlink" title="在底层的 Square 中先做些基础工作"></a>在底层的 Square 中先做些基础工作</h1><h2 id="props"><a href="#props" class="headerlink" title="props"></a>props</h2><p>我们在 Board 中向 Square 传递的数据，从而控制 Square 应该显示什么。从父向子传递数据，就需要用到 props 。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*父*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Board</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">renderSquare</span>(<span class="params">i</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Square</span> <span class="attr">value</span>=<span class="string">&#123;i&#125;</span> /&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*子*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Square</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;button className=<span class="string">&quot;square&quot;</span>&gt;</span><br><span class="line">        &#123;<span class="built_in">this</span>.props.value&#125;</span><br><span class="line">      &lt;/button&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意，这里我们的 props 名为 value ，当然我们也可以使用其他的名称，但是注意避免使用到保留字（如 key）。</p>
<h2 id="component-的交互"><a href="#component-的交互" class="headerlink" title="component 的交互"></a>component 的交互</h2><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Square</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line"> <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">   <span class="keyword">return</span> (</span><br><span class="line">     &lt;button className=<span class="string">&quot;square&quot;</span> onClick=&#123;<span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;click&#x27;</span>)&#125;&gt;</span><br><span class="line">       &#123;<span class="built_in">this</span>.props.value&#125;</span><br><span class="line">     &lt;/button&gt;</span><br><span class="line">   );</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>对于传递函数作为参数，需要注意不可以直接传递函数本身，这样会直接调用函数并返回一个 undefine 给 onClick 。常用的做法是在外面包一层匿名函数，然后在匿名函数里执行真正的函数。</li>
<li>另外，我们使用箭头函数（特殊的匿名函数），是因为它不绑定 this ，能够捕获其上下文的 this ，减少出现 bug 的可能。</li>
</ol>
<h2 id="state"><a href="#state" class="headerlink" title="state"></a>state</h2><p>我们通过 state 记录控件状态，</p>
<p>在 Button 的 onClick 函数中，状态值被 setState() 函数更新之后，会通知 Square 重新渲染界面。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Square</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">props</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>(props);</span><br><span class="line">    <span class="built_in">this</span>.state = &#123;</span><br><span class="line">      value: <span class="literal">null</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;button</span><br><span class="line">        className=<span class="string">&quot;square&quot;</span></span><br><span class="line">        onClick=&#123;<span class="function">() =&gt;</span> <span class="built_in">this</span>.setState(&#123;<span class="attr">value</span>: <span class="string">&#x27;X&#x27;</span>&#125;)&#125;</span><br><span class="line">      &gt;</span><br><span class="line">        &#123;<span class="built_in">this</span>.state.value&#125;</span><br><span class="line">      &lt;/button&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当在 component 调用 setState 函数后，React 也会自动更新子 component。</p>
<h2 id="已完成"><a href="#已完成" class="headerlink" title="已完成"></a>已完成</h2><p>可响应用户点击的交互界面</p>
<h1 id="在中层的-Board-进行游戏规则的实现"><a href="#在中层的-Board-进行游戏规则的实现" class="headerlink" title="在中层的 Board 进行游戏规则的实现"></a>在中层的 Board 进行游戏规则的实现</h1><h2 id="Lift-State-Up"><a href="#Lift-State-Up" class="headerlink" title="Lift State Up"></a>Lift State Up</h2><p>目前的应用虽然在 Square 中记录了 state ，但是它的作用空间太小，凭此无法记录游戏中还需要的两个重要数据：</p>
<ol>
<li>棋盘当前状态，用于判断游戏终止</li>
<li>当前落子的用户，用于实现轮换落子</li>
</ol>
<ul>
<li>对于第一点：<ol>
<li>我们把每个 Square 中的状态提升并集中到 Board 中，用数组中统一管理，用来表示当前棋盘状态，可以为 ‘X’ , ‘O’ 或 null 。 <figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Board</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">props</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>(props);</span><br><span class="line">    <span class="built_in">this</span>.state = &#123;</span><br><span class="line">      squares: <span class="built_in">Array</span>(<span class="number">9</span>).fill(<span class="literal">null</span>),</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">renderSquare</span>(<span class="params">i</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Square</span> <span class="attr">value</span>=<span class="string">&#123;this.state.squares[i]&#125;</span> /&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">	<span class="comment">/*...*/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>在统一管理状态时，除了初始化赋值，还需要能够修改它。因此，需要从 Board 向 Square 传入 handleClick(i) 函数，与 每个 Square 对应。 <figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">handleClick</span>(<span class="params">i</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> squares = <span class="built_in">this</span>.state.squares.slice();</span><br><span class="line">    squares[i] = <span class="string">&#x27;X&#x27;</span>;</span><br><span class="line">    <span class="built_in">this</span>.setState(&#123;<span class="attr">squares</span>: squares&#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">renderSquare</span>(<span class="params">i</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;Square</span><br><span class="line">        value=&#123;<span class="built_in">this</span>.state.squares[i]&#125;</span><br><span class="line">        onClick=&#123;<span class="function">() =&gt;</span> <span class="built_in">this</span>.handleClick(i)&#125;</span><br><span class="line">      /&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
</li>
<li>善后工作，因为状态已经提升出去了，因此需要对 Square 这个 component 进行修改: 删除不必要的构造函数 + 从 prop 中获取 value + 从 prop 中获取 onClick 函数。 <figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Square</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;button</span><br><span class="line">        className=<span class="string">&quot;square&quot;</span></span><br><span class="line">        onClick=&#123;<span class="function">() =&gt;</span> <span class="built_in">this</span>.props.onClick()&#125;</span><br><span class="line">				<span class="comment">/*onClick=&#123;this.props.onClick&#125;*/</span></span><br><span class="line">      &gt;</span><br><span class="line">        &#123;<span class="built_in">this</span>.props.value&#125;</span><br><span class="line">      &lt;/button&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>进一步简化：Function Components 目前， Square 完全成为一个 controlled components ，因为它不仅接收 Board 的赋值，而且在自身改变时（如被点击）会通知 Board 。由于它只含有一个 render 方法，没有自身的状态，因此我们可以使用 Function component 代替 Class component 的写法，使程序更加简洁：Function component 的输入参数是 props ，返回值为待渲染控件。 <figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*Class component*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Square</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;button</span><br><span class="line">        className=<span class="string">&quot;square&quot;</span></span><br><span class="line">        onClick=&#123;<span class="function">() =&gt;</span> <span class="built_in">this</span>.props.onClick()&#125;</span><br><span class="line">				<span class="comment">/*onClick=&#123;this.props.onClick&#125;*/</span></span><br><span class="line">      &gt;</span><br><span class="line">        &#123;<span class="built_in">this</span>.props.value&#125;</span><br><span class="line">      &lt;/button&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*Function component*/</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Square</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;button className=<span class="string">&quot;square&quot;</span> onClick=&#123;props.onClick&#125;&gt;</span><br><span class="line">      &#123;props.value&#125;</span><br><span class="line">    &lt;/button&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
<li>对于第二点  需要添加一个状态值用于记录轮换状态 ，并且每次点击之后，转换这个状态。官网教程使用 xIsNext 这个逻辑用于判断轮换：  <figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Board</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">props</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>(props);</span><br><span class="line">    <span class="built_in">this</span>.state = &#123;</span><br><span class="line">      squares: <span class="built_in">Array</span>(<span class="number">9</span>).fill(<span class="literal">null</span>),</span><br><span class="line">      xIsNext: <span class="literal">true</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="title">handleClick</span>(<span class="params">i</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> squares = <span class="built_in">this</span>.state.squares.slice();</span><br><span class="line">    squares[i] = <span class="built_in">this</span>.state.xIsNext ? <span class="string">&#x27;X&#x27;</span> : <span class="string">&#x27;O&#x27;</span>;</span><br><span class="line">    <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">      squares: squares,</span><br><span class="line">      xIsNext: !<span class="built_in">this</span>.state.xIsNext,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> status = <span class="string">&#x27;Next player: &#x27;</span> + (<span class="built_in">this</span>.state.xIsNext ? <span class="string">&#x27;X&#x27;</span> : <span class="string">&#x27;O&#x27;</span>);</span><br><span class="line">		<span class="comment">/*...*/</span></span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/*...*/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
  注意：在 handleClick 函数中，对于 squares（state）的更新，并非直接改变它的值，而是先设置 squares（temp），然后再通过 setState 函数更新 squares （state）。</li>
</ul>
<h2 id="游戏终止逻辑"><a href="#游戏终止逻辑" class="headerlink" title="游戏终止逻辑"></a>游戏终止逻辑</h2><p>首先，游戏终止的判断一定是在点击触发时执行的，有两个条件会造成游戏终止：</p>
<ol>
<li>有玩家获胜：在每次点击之后，将当前棋盘状态与所有可能获胜的组合对比，如果获胜则返回当前玩家符号。 <figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">calculateWinner</span>(<span class="params">squares</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> lines = [</span><br><span class="line">    [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>],</span><br><span class="line">    [<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>],</span><br><span class="line">    [<span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>],</span><br><span class="line">    [<span class="number">0</span>, <span class="number">3</span>, <span class="number">6</span>],</span><br><span class="line">    [<span class="number">1</span>, <span class="number">4</span>, <span class="number">7</span>],</span><br><span class="line">    [<span class="number">2</span>, <span class="number">5</span>, <span class="number">8</span>],</span><br><span class="line">    [<span class="number">0</span>, <span class="number">4</span>, <span class="number">8</span>],</span><br><span class="line">    [<span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>],</span><br><span class="line">  ];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; lines.length; i++) &#123;</span><br><span class="line">    <span class="keyword">const</span> [a, b, c] = lines[i];</span><br><span class="line">    <span class="keyword">if</span> (squares[a] &amp;&amp; squares[a] === squares[b] &amp;&amp; squares[a] === squares[c]) &#123;</span><br><span class="line">      <span class="keyword">return</span> squares[a];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>棋盘下满：官方文档没有专门进行判断。因为在 handleClick 函数中，还规定了在同一位置不能重复落子，所以棋盘下满时，用户必然无法进行其他操作。 <figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">handleClick</span>(<span class="params">i</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> squares = <span class="built_in">this</span>.state.squares.slice();</span><br><span class="line">    <span class="keyword">if</span> (calculateWinner(squares) || squares[i]) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    squares[i] = <span class="built_in">this</span>.state.xIsNext ? <span class="string">&#x27;X&#x27;</span> : <span class="string">&#x27;O&#x27;</span>;</span><br><span class="line">    <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">      squares: squares,</span><br><span class="line">      xIsNext: !<span class="built_in">this</span>.state.xIsNext,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="已完成-1"><a href="#已完成-1" class="headerlink" title="已完成"></a>已完成</h2><p>可响应用户点击的交互界面 + 可以判断赢家的游戏机制</p>
<h1 id="在高层的-Game-实现历史记录功能"><a href="#在高层的-Game-实现历史记录功能" class="headerlink" title="在高层的 Game 实现历史记录功能"></a>在高层的 Game 实现历史记录功能</h1><h2 id="Lifting-State-Up-Again"><a href="#Lifting-State-Up-Again" class="headerlink" title="Lifting State Up, Again"></a>Lifting State Up, Again</h2><p>为了实现历史记录，需要把棋盘状态在更高一层的 Game 里进行管理，顺带把 Board 的其他状态或者处理函数也一并上提。</p>
<ul>
<li>对于 Board ，状态上提后需要调整 state 为 props：  <figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Board</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">renderSquare</span>(<span class="params">i</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;Square</span><br><span class="line">        value=&#123;<span class="built_in">this</span>.props.squares[i]&#125;</span><br><span class="line">        onClick=&#123;<span class="function">() =&gt;</span> <span class="built_in">this</span>.props.onClick(i)&#125;</span><br><span class="line">      /&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;div className=<span class="string">&quot;board-row&quot;</span>&gt;</span><br><span class="line">					<span class="comment">/*...*/</span></span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">				<span class="comment">/*...*/</span></span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>对于 Game，则需要将添加一些内容：  在 state 中引入 history 数组，记录每次落子（点击）前的棋盘状态，并把 xIsNext 也添加到 state 中：  <figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Game</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">props</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>(props);</span><br><span class="line">    <span class="built_in">this</span>.state = &#123;</span><br><span class="line">      history: [&#123;</span><br><span class="line">        squares: <span class="built_in">Array</span>(<span class="number">9</span>).fill(<span class="literal">null</span>)</span><br><span class="line">      &#125;],</span><br><span class="line">      xIsNext: <span class="literal">true</span></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">	<span class="comment">/*...*/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
  在 handleClick 函数中，我们基于最近的历史记录进行判断，是否可以落子，如果可以落子，则将落子后的状态附加到 history ：  <figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Game</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">handleClick</span>(<span class="params">i</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> history = <span class="built_in">this</span>.state.history;</span><br><span class="line">    <span class="keyword">const</span> current = history[history.length - <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">const</span> squares = current.squares.slice();</span><br><span class="line">    <span class="keyword">if</span> (calculateWinner(squares) || squares[i]) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    squares[i] = <span class="built_in">this</span>.state.xIsNext ? <span class="string">&#x27;X&#x27;</span> : <span class="string">&#x27;O&#x27;</span>;</span><br><span class="line">    <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">      history: history.concat([&#123;</span><br><span class="line">        squares: squares</span><br><span class="line">      &#125;]),</span><br><span class="line">      xIsNext: !<span class="built_in">this</span>.state.xIsNext,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">	<span class="comment">/*...*/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
  在 render 函数中，增加显示 game-info 的逻辑。  <figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Game</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">	<span class="comment">/*...*/</span></span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> history = <span class="built_in">this</span>.state.history;</span><br><span class="line">    <span class="keyword">const</span> current = history[history.length - <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">const</span> winner = calculateWinner(current.squares);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> status;</span><br><span class="line">    <span class="keyword">if</span> (winner) &#123;</span><br><span class="line">      status = <span class="string">&#x27;Winner: &#x27;</span> + winner;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      status = <span class="string">&#x27;Next player: &#x27;</span> + (<span class="built_in">this</span>.state.xIsNext ? <span class="string">&#x27;X&#x27;</span> : <span class="string">&#x27;O&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div className=<span class="string">&quot;game&quot;</span>&gt;</span><br><span class="line">        &lt;div className=<span class="string">&quot;game-board&quot;</span>&gt;</span><br><span class="line">          &lt;Board</span><br><span class="line">            squares=&#123;current.squares&#125;</span><br><span class="line">            onClick=&#123;<span class="function">(<span class="params">i</span>) =&gt;</span> <span class="built_in">this</span>.handleClick(i)&#125;</span><br><span class="line">          /&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div className=<span class="string">&quot;game-info&quot;</span>&gt;</span><br><span class="line">          &lt;div&gt;&#123;status&#125;&lt;/div&gt;</span><br><span class="line">          &lt;ol&gt;&#123;<span class="comment">/* TODO */</span>&#125;&lt;/ol&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
  你可能注意到了，这里我们在 history 里只记录了棋盘状态，而没有记录当时落子的用户是谁。</li>
</ul>
<h2 id="显示历史落子记录"><a href="#显示历史落子记录" class="headerlink" title="显示历史落子记录"></a>显示历史落子记录</h2><p>我们在 game-info 里显示历史记录，通过 map 函数将 history 中的历史记录逐一生成有序列表<ol >的元素<li>，其中包含了可以点击跳转的 button 。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Game</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">	    <span class="keyword">const</span> history = <span class="built_in">this</span>.state.history;</span><br><span class="line">			<span class="comment">/*...*/</span></span><br><span class="line">	</span><br><span class="line">	    <span class="keyword">const</span> moves = history.map(<span class="function">(<span class="params">step, move</span>) =&gt;</span> &#123;</span><br><span class="line">	      <span class="keyword">const</span> desc = move ? (<span class="string">&#x27;Go to move #&#x27;</span> + move) : (<span class="string">&#x27;Go to game start&#x27;</span>);</span><br><span class="line">	      <span class="keyword">return</span> (</span><br><span class="line">	        &lt;li&gt;</span><br><span class="line">	          &lt;button onClick=&#123;<span class="function">() =&gt;</span> <span class="built_in">this</span>.jumpTo(move)&#125;&gt;&#123;desc&#125;&lt;/button&gt;</span><br><span class="line">	        &lt;/li&gt;</span><br><span class="line">	      );</span><br><span class="line">	    &#125;);</span><br><span class="line">	</span><br><span class="line">			<span class="comment">/*...*/</span></span><br><span class="line">			</span><br><span class="line">	    <span class="keyword">return</span> (</span><br><span class="line">	      &lt;div className=<span class="string">&quot;game&quot;</span>&gt;</span><br><span class="line">					<span class="comment">/*...*/</span></span><br><span class="line">	        &lt;div className=<span class="string">&quot;game-info&quot;</span>&gt;</span><br><span class="line">	          &lt;div&gt;&#123;status&#125;&lt;/div&gt;</span><br><span class="line">	          &lt;ol&gt;&#123;moves&#125;&lt;/ol&gt;</span><br><span class="line">	        &lt;/div&gt;</span><br><span class="line">	      &lt;/div&gt;</span><br><span class="line">	    );</span><br><span class="line">	  &#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>map 函数的参数 step 和 move 可以看作是 value 和 index 。</p>
<h2 id="Picking-a-Key"><a href="#Picking-a-Key" class="headerlink" title="Picking a Key"></a>Picking a Key</h2><p>完成上述步骤后，你会得到下列警告：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Warning: Each child <span class="keyword">in</span> an array or iterator should have a unique “key” prop. Check the render method <span class="keyword">of</span> “Game”.</span><br></pre></td></tr></table></figure>
<p>这是因为当 React 渲染列表时，它会存储每个元素的信息，当我们更新列表时，React 需要根据这个来确定哪些地方改变了，我们才能够看到列表元素的增、删、重新排序、改。因此我们需要给每个列表元素一个 key ，React 通过维护和更新这些 key 来实现列表的更新。因此，当你构建动态列表时，一定要分配适当的 key 。</p>
<p>在官网教程中，使用 move （即 history 的 index）作为 key，它表示步数序号。这里能够安全使用 move 作为 key 的原因，是因为这里的列表元素不会重新排序、删除或者在中间插入， 因此步数序号与执行步骤一一对应。另外，key 无需全局唯一，它只需要在同一级的 component 直接唯一即可。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Game</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">	<span class="comment">/*...*/</span></span><br><span class="line">	<span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> history = <span class="built_in">this</span>.state.history;</span><br><span class="line">		<span class="comment">/*...*/</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> moves = history.map(<span class="function">(<span class="params">step, move</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> desc = move ? (<span class="string">&#x27;Go to move #&#x27;</span> + move) : (<span class="string">&#x27;Go to game start&#x27;</span>);</span><br><span class="line">      <span class="keyword">return</span> (</span><br><span class="line">        &lt;li&gt;</span><br><span class="line">          &lt;button onClick=&#123;<span class="function">() =&gt;</span> <span class="built_in">this</span>.jumpTo(move)&#125;&gt;&#123;desc&#125;&lt;/button&gt;</span><br><span class="line">        &lt;/li&gt;</span><br><span class="line">      );</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">		<span class="comment">/*...*/</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="历史记录跳转功能"><a href="#历史记录跳转功能" class="headerlink" title="历史记录跳转功能"></a>历史记录跳转功能</h2><p>接下来我们要做的事情就是点击按钮可以跳转到对应的历史记录。分为以下两步：</p>
<ol>
<li>将点击的按钮与对应历史绑定</li>
<li>更新跳转后的状态</li>
<li>调整渲染逻辑</li>
</ol>
<p>对于第一点：将历史记录的序号与点击跳转按钮的序号对应即可：在给每一个历史记录按钮添加对应的 key (move) 之后，我们在 Game 的 state 中添加 stepNumber 状态，使得 move 和 stepNumber 两者相互配合：即点击某一条历史记录，跳转到与之 key (move) 对应的 stepNumber 历史。</p>
<p>对于第二点：有两处的状态需要更新，</p>
<ol>
<li>跳转函数执行时，需要更新 xIsNext 状态</li>
<li>点击棋盘函数执行时，需要更新新增的 stepNumber 状态</li>
</ol>
<p>在新增状态之后，点击棋盘函数处理的 history 也应开始使用最近的基于当前上下文的历史而非完整历史。这样在每次跳转历史之后，总能基于当前的状态重新记录历史。</p>
<p>对于第三点：</p>
<p>我们修改一下渲染逻辑，从总是渲染最新历史，变更为渲染当前上下文对应的历史记录即可：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Game</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">props</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>(props);</span><br><span class="line">    <span class="built_in">this</span>.state = &#123;</span><br><span class="line">      history: [&#123;</span><br><span class="line">        squares: <span class="built_in">Array</span>(<span class="number">9</span>).fill(<span class="literal">null</span>),</span><br><span class="line">      &#125;],</span><br><span class="line">      stepNumber: <span class="number">0</span>,  <span class="comment">/*新增状态*/</span></span><br><span class="line">      xIsNext: <span class="literal">true</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="title">jumpTo</span>(<span class="params">step</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">      stepNumber: step,</span><br><span class="line">			xIsNext: (step % <span class="number">2</span>) === <span class="number">0</span>,  <span class="comment">/*第一处状态更新*/</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="title">handleClick</span>(<span class="params">i</span>)</span> &#123;</span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">		const history = this.state.history;</span></span><br><span class="line"><span class="comment">		*/</span></span><br><span class="line">    <span class="keyword">const</span> history = <span class="built_in">this</span>.state.history.slice(<span class="number">0</span>, <span class="built_in">this</span>.state.stepNumber + <span class="number">1</span>);  <span class="comment">/*使用当前上下文的历史*/</span></span><br><span class="line">    <span class="keyword">const</span> current = history[history.length - <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">const</span> squares = current.squares.slice();</span><br><span class="line">    <span class="keyword">if</span> (calculateWinner(squares) || squares[i]) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    squares[i] = <span class="built_in">this</span>.state.xIsNext ? <span class="string">&#x27;X&#x27;</span> : <span class="string">&#x27;O&#x27;</span>;</span><br><span class="line">    <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">      history: history.concat([&#123;</span><br><span class="line">        squares: squares</span><br><span class="line">      &#125;]),</span><br><span class="line">      stepNumber: history.length,  <span class="comment">/*第二处状态更新*/</span></span><br><span class="line">      xIsNext: !<span class="built_in">this</span>.state.xIsNext,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">	    <span class="keyword">const</span> history = <span class="built_in">this</span>.state.history;</span><br><span class="line">	    <span class="keyword">const</span> current = history[<span class="built_in">this</span>.state.stepNumber];  <span class="comment">/*渲染当前上下文对应的历史*/</span></span><br><span class="line">	    <span class="keyword">const</span> winner = calculateWinner(current.squares);</span><br><span class="line">			<span class="comment">/*...*/</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>至此，TIc-Toc-Toe 基本完成。</p>
<h1 id="TODO"><a href="#TODO" class="headerlink" title="TODO"></a>TODO</h1><ol>
<li><p>Display the location for each move in the format (col, row) in the move history list.</p>
</li>
<li><p>Bold the currently selected item in the move list.</p>
</li>
<li><p>Rewrite Board to use two loops to make the squares instead of hardcoding them.</p>
</li>
<li><p>Add a toggle button that lets you sort the moves in either ascending or descending order.</p>
</li>
<li><p>When someone wins, highlight the three squares that caused the win.</p>
</li>
<li><p>When no one wins, display a message about the result being a draw.</p>
</li>
</ol>
</article></main></body></html>
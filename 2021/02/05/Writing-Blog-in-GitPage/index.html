<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Blog in GitPage | Kyno&#39;s Blog🐱‍🏍</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="通过GitPage搭建博客多次，每次都有新感觉（大雾）。   问题分析问题是我想将网站的静态页面文件和博客构建源码文件分开提交，如何解决？   解决思路方案一：双仓库 建立两个仓库：blogname.github.io和blogsource，分别存放博客静态页面和博客搭建源码。   本地与之对应建立两个目录并与远程仓库关联。   实际操作时，在blogsource目录中执行hexo基本操作，生成博">
<meta property="og:type" content="article">
<meta property="og:title" content="Blog in GitPage">
<meta property="og:url" content="http://example.com/2021/02/05/Writing-Blog-in-GitPage/index.html">
<meta property="og:site_name" content="Kyno&#39;s Blog🐱‍🏍">
<meta property="og:description" content="通过GitPage搭建博客多次，每次都有新感觉（大雾）。   问题分析问题是我想将网站的静态页面文件和博客构建源码文件分开提交，如何解决？   解决思路方案一：双仓库 建立两个仓库：blogname.github.io和blogsource，分别存放博客静态页面和博客搭建源码。   本地与之对应建立两个目录并与远程仓库关联。   实际操作时，在blogsource目录中执行hexo基本操作，生成博">
<meta property="og:locale">
<meta property="article:published_time" content="2021-02-05T16:00:00.000Z">
<meta property="article:modified_time" content="2021-02-06T09:45:35.649Z">
<meta property="article:author" content="Kyno Yang">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Kyno's Blog🐱‍🏍" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Kyno&#39;s Blog🐱‍🏍</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">棉纺厂原住民，东纺幼儿园毕业生</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Suche"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Suche"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-Writing-Blog-in-GitPage" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/02/05/Writing-Blog-in-GitPage/" class="article-date">
  <time class="dt-published" datetime="2021-02-05T16:00:00.000Z" itemprop="datePublished">2021-02-06</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      Blog in GitPage
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>通过GitPage搭建博客多次，每次都有新感觉（大雾）。  </p>
<h2 id="问题分析"><a href="#问题分析" class="headerlink" title="问题分析"></a>问题分析</h2><p>问题是我想将网站的静态页面文件和博客构建源码文件分开提交，如何解决？  </p>
<h2 id="解决思路"><a href="#解决思路" class="headerlink" title="解决思路"></a>解决思路</h2><h3 id="方案一：双仓库"><a href="#方案一：双仓库" class="headerlink" title="方案一：双仓库"></a><del>方案一：双仓库</del></h3><ol>
<li>建立两个仓库：blogname.github.io和blogsource，分别存放博客静态页面和博客搭建源码。  </li>
<li>本地与之对应建立两个目录并与远程仓库关联。  </li>
<li>实际操作时，在blogsource目录中执行hexo基本操作，生成博客后，将public文件夹中的内容拷贝到本地的blogname.github.io仓库中，最后将两个目录都同步到远程仓库。<br>这种方法容易理解，但是写完博客后的拷贝工作是繁琐的事，于是想到了下面这个方法。  </li>
</ol>
<h3 id="方案二：双仓库改进版"><a href="#方案二：双仓库改进版" class="headerlink" title="方案二：双仓库改进版"></a><del>方案二：双仓库改进版</del></h3><ol>
<li>考虑到每次生成的博客静态页面都是在public目录下，将public\目录关联到远程仓库blogname.github.io，方案一中的本地静态页面仓库可以弃用了。  </li>
<li>每次生成静态页面后，先将blogsource\提交到远端仓库，再进入public\目录把它也提交到与之对应的远端仓库，这样就不用再来回拷贝静态页面文件了。  </li>
</ol>
<h3 id="方案三：双分支（未成功）"><a href="#方案三：双分支（未成功）" class="headerlink" title="方案三：双分支（未成功）"></a><del>方案三：双分支（未成功）</del></h3><ol>
<li>在博客仓库上建立两个分支: master分支与 source 分支，master分支部署静态页面。source分支用以提交博客源码。  </li>
<li>克隆远程博客仓库，本地切换到新建的source分支  </li>
<li>进入新建的临时文件夹，使用hexo init初始化，然后将临时文件夹中的内容拷贝到空博客仓库里,最后将本地仓库提交到远程source分支。至此，博客的source源码分支构建成功  </li>
<li>执行 hexo g 生成静态页面，将仓库中的(.git/ &amp; .gitignore) 拷贝到public\目录里，进入该目录，切换到新建的master分支，将更新提交到远程master分支。至此，博客的master静态页面分支构建成功。<br>但是，这只在博客刚搭建好，第一次提交的时候管用！<br>因为Git的分支是独立的，虽然每次source分支执行hexo g会更新public\目录的内容，但是在切换到master分支后，\publib目录的内容也会随之切换到master版本，也就是未更新版本。即：master分支中的public\的内容不会随着source分支改变其中内容而改变，这也正是Git版本管理的特点之一，所以Git的分支不太适合「子文件夹」这种需求（需要git checkout –orphan master和git submodule结合起来使用，有些麻烦就没有尝试了，另外SVN的分支模型可能更符合这种需求描述）。<br>如果使用这种方法，每次都要：先切换到source分支，拷贝public\中的内容，然后进入public\文件夹，切换到master分支，将刚才拷贝的内容覆盖当前目录（相当麻烦！）。  </li>
</ol>
<h3 id="方案四：双分支-hexo-deployer-git"><a href="#方案四：双分支-hexo-deployer-git" class="headerlink" title="方案四：双分支 + hexo-deployer-git"></a><del>方案四：双分支 + hexo-deployer-git</del></h3><p>注：笔者最近重新部署博客时，hexo-deployer-git插件在生成.deploy_git\目录并正确拷贝后，不能按config文件的设定提交到远端指定分支，类似于该<a target="_blank" rel="noopener" href="https://github.com/hexojs/hexo-deployer-git/issues/66">issue</a>，未能找到原因，故不推荐该方法。</p>
<p>沿着方案三的思路，目前的难点在于如何同步public\中的内容，我们可以通过使用hexo-deployer-git插件加以解决。  </p>
<p>实现步骤（方案四）：<br>对于本地hexo环境的搭建（安装Node.js和Git）这里不做赘述,注意npm安装时添加<code>--save</code>参数。  </p>
<h4 id="第一步"><a href="#第一步" class="headerlink" title="第一步"></a>第一步</h4><p>在Github上新建一个仓库，命名为username.github.io，不添加README文件，不添加gitignore文件，添加Apache License 2.0。<br>创建完成后，在仓库的设置中设置开启gitpage以及强制https。<br>最后，将仓库克隆到本地。  </p>
<h4 id="第二步"><a href="#第二步" class="headerlink" title="第二步"></a>第二步</h4><p>首先，在桌面新建一个临时文件夹blog\，进入文件夹，执行hexo init。修改生成的_config.yml文件的deploy项：  </p>
<pre><code>deploy:  
  type: git   
  repo: https://github.com/username/blogname.github.io  
  branch: master  
</code></pre>
<p>然后，克隆仓库到本地，进入仓库，切换到新建的source分支：  </p>
<pre><code>git checkout -b source  
</code></pre>
<p>之后，将blog\中所有内容拷贝到本地仓库中，将更新提交到远程source分支。<br>至此，博客源码部署完成。  </p>
<h4 id="第三步"><a href="#第三步" class="headerlink" title="第三步"></a>第三步</h4><p>确认当前本地仍处于source分支。  </p>
<ol>
<li>在仓库中执行<code>hexo g</code>，生成静态页面  </li>
<li>安装hexo-deployer-git:<code>npm install hexo-deployer-git --save</code>  </li>
<li>执行<code>hexo d</code>,将静态页面部署到远程仓库的master分支。</li>
</ol>
<p>至此，博客静态页面部署完成。  </p>
<h4 id="Tips"><a href="#Tips" class="headerlink" title="Tips"></a>Tips</h4><p>在上述操作都完成后，把github中远程博客仓库的默认分支改为source，这样以后源码提交时就不用考虑远程切换到source分支了。  </p>
<h4 id="重新部署"><a href="#重新部署" class="headerlink" title="重新部署"></a>重新部署</h4><p>如果需要在新的机器上重新部署本地环境，需要进行以下步骤：  </p>
<ol>
<li>配置hexo基本环境（安装Node.js、Git、hexo-deployer-git插件）  </li>
<li>克隆远程仓库  </li>
<li>切换到source分支，安装hexo-deployer-git插件  </li>
<li>执行<code>hexo new &#39;article&#39;</code>写文章，写完后push到远程source分支  </li>
<li>执行<code>hexo g -d</code>，生成静态页面并推送到远程仓库的master分支  </li>
</ol>
<h3 id="方案五：双分支-Travis-CI"><a href="#方案五：双分支-Travis-CI" class="headerlink" title="方案五：双分支 + Travis CI"></a>方案五：双分支 + Travis CI</h3><p>将CI/CD（持续集成和持续部署）应用到GitPage中，可以通过脚本自动部署更新博客，提升任务效率。<br>具体步骤根据<a target="_blank" rel="noopener" href="https://hexo.io/zh-cn/docs/github-pages.html">官网教程</a>即可，操作时注意两点：  </p>
<ol>
<li>travis脚本中的分支名注意修改为main</li>
<li><code>.travis.yml</code>提交到远端后，CI就会触发，需要时间更新内容，可以在travis-ci官网查看进度</li>
<li>如果 commit 不想让 Travis 构建，那么就在 commit message 里加上ci skip即可:<code>git commit -m &quot;[ci skip] first commit&quot; </code>。</li>
</ol>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ul>
<li><code>git add -参数</code>  <ul>
<li><code>git add *</code>中*不是Git的一部分,它是一个由shell解释的通配符，该命令意味着添加当前目录中的所有文件，但以点开头的文件除外。  </li>
<li><code>git add .</code>在shell中没有特殊的意义，因此Git递归地添加了整个目录，包含了名字以点开头的文件。对仓库的增、改敏感。  </li>
<li><code>git add -A</code> 对仓库的增、删、改都敏感。  </li>
<li><code>git add -u</code> 对仓库的删、改敏感  </li>
</ul>
</li>
<li>Git的各分支独立，若要实现子文件夹的管理，最好使用多仓库，不宜使用多分支。或者使用SVN分支管理。  </li>
<li>官方文档对于如何实现以及使用的描述更加详细（如<a target="_blank" rel="noopener" href="https://hexo.io/zh-cn/docs/deployment">Hexo部署文档</a>），在有官方文档且能读懂的情况下，官方文档优先，然后再考虑博客文档。     </li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/02/05/Writing-Blog-in-GitPage/" data-id="ckktj89rl00010lqa1f5ghvt1" data-title="Blog in GitPage" class="article-share-link">Teilen</a>
      
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2019/08/29/Learning-DenseBox/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Älter</strong>
      <div class="article-nav-title">DenseBox代码解析</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archiv</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">February 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">letzter Beitrag</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/02/05/Writing-Blog-in-GitPage/">Blog in GitPage</a>
          </li>
        
          <li>
            <a href="/2019/08/29/Learning-DenseBox/">DenseBox代码解析</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2021 Kyno Yang<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>